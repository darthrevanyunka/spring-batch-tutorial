<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spring Batch Tutorial - Advanced Job Monitor</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }
        .header {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        .header h1 {
            margin-bottom: 10px;
            color: #34495e;
        }
        .button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }
        .button.danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }
        .button.success {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }
        .button.warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }
        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            border-left: 4px solid;
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .status.success {
            background-color: #d4edda;
            color: #155724;
            border-left-color: #28a745;
        }
        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border-left-color: #dc3545;
        }
        .status.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border-left-color: #17a2b8;
        }
        .status.warning {
            background-color: #fff3cd;
            color: #856404;
            border-left-color: #ffc107;
        }
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .card {
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            background-color: #fff;
            transition: all 0.3s ease;
        }
        .card:hover {
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        .card h3 {
            margin-top: 0;
            color: #2c3e50;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 10px;
        }
        .progress-container {
            background-color: #ecf0f1;
            border-radius: 10px;
            padding: 3px;
            margin: 10px 0;
        }
        .progress-bar {
            background: linear-gradient(90deg, #667eea, #764ba2);
            height: 20px;
            border-radius: 8px;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background-image: linear-gradient(
                -45deg,
                rgba(255, 255, 255, .2) 25%,
                transparent 25%,
                transparent 50%,
                rgba(255, 255, 255, .2) 50%,
                rgba(255, 255, 255, .2) 75%,
                transparent 75%,
                transparent
            );
            background-size: 50px 50px;
            animation: move 2s linear infinite;
        }
        @keyframes move {
            0% { background-position: 0 0; }
            100% { background-position: 50px 50px; }
        }
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
        }
        .step {
            flex: 1;
            text-align: center;
            padding: 10px;
            margin: 0 5px;
            border-radius: 8px;
            background-color: #ecf0f1;
            position: relative;
        }
        .step.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        .step.completed {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
        }
        .step.failed {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }
        .execution-history {
            max-height: 400px;
            overflow-y: auto;
        }
        .execution-item {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            background-color: #f8f9fa;
        }
        .execution-item.success {
            border-left-color: #27ae60;
            background-color: #d4edda;
        }
        .execution-item.failed {
            border-left-color: #e74c3c;
            background-color: #f8d7da;
        }
        .execution-item.running {
            border-left-color: #f39c12;
            background-color: #fff3cd;
        }
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .metric {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 8px;
        }
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .metric-label {
            font-size: 12px;
            opacity: 0.9;
        }
        .refresh-indicator {
            display: inline-block;
            margin-left: 10px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .tabs {
            display: flex;
            border-bottom: 2px solid #ecf0f1;
            margin-bottom: 20px;
        }
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        .tab.active {
            border-bottom-color: #667eea;
            color: #667eea;
            font-weight: bold;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üöÄ Spring Batch Advanced Job Monitor</h1>
        <p>Real-time monitoring and control for your batch processing jobs</p>
    </div>

    <div class="container">
        <div class="tabs">
            <div class="tab active" onclick="switchTab('dashboard')">üìä Dashboard</div>
            <div class="tab" onclick="switchTab('executions')">üìã Execution History</div>
            <div class="tab" onclick="switchTab('metrics')">üìà Metrics</div>
            <div class="tab" onclick="switchTab('logs')">üìù Logs</div>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <h2>Job Control & Status</h2>
            <div style="margin-bottom: 12px">
                <label>Scenario: 
                    <select id="scenarioSelect">
                        <option value="SUCCESS">SUCCESS</option>
                        <option value="PARTIAL">PARTIAL</option>
                        <option value="FAIL">FAIL</option>
                        <option value="RETRYABLE">RETRYABLE</option>
                    </select>
                </label>
                <label style="margin-left: 12px;">Large File: 
                    <select id="largeFileSelect">
                        <option value="">(default - small file)</option>
                        <option value="input/samples/persons_partial_10k.csv">10k records (large)</option>
                    </select>
                </label>
                <label style="margin-left: 12px;">skipEvery: <input id="skipEveryInput" type="number" min="0" placeholder="e.g. 3" style="width: 80px;"></label>
                <label style="margin-left: 12px;">retryAttempts: <input id="retryAttemptsInput" type="number" min="0" placeholder="e.g. 2" style="width: 80px;"></label>
                <label style="margin-left: 12px;">CSV file:
                    <select id="csvSelect">
                        <option value="">(default)</option>
                        <option value="input/samples/persons_success.csv">persons_success.csv</option>
                        <option value="input/samples/persons_partial.csv">persons_partial.csv</option>
                        <option value="input/samples/persons_fail.csv">persons_fail.csv</option>
                        <option value="input/samples/persons_retryable.csv">persons_retryable.csv</option>
                        <option value="input/persons_fix_scenario_step1.csv">persons_fix_scenario_step1.csv</option>
                        <option value="input/persons_fix_scenario_step2_fixed.csv">persons_fix_scenario_step2_fixed.csv</option>
                    </select>
                </label>
            </div>
            <button class="button" onclick="startJob()">‚ñ∂Ô∏è Start Job</button>
            <button class="button success" onclick="refreshJobStatus()">üîÑ Refresh Status</button>
            <button class="button warning" onclick="stopJob()">‚èπÔ∏è Stop Job</button>
            <button class="button danger" onclick="restartJob()">üîÑ Restart Job</button>
            <div id="jobStatus"></div>

            <div class="dashboard">
                <div class="card">
                    <h3>üìà Current Progress</h3>
                    <div id="progressContainer" class="progress-container">
                        <div id="progressBar" class="progress-bar" style="width: 0%"></div>
                    </div>
                    <div id="progressText">No job running</div>
                </div>

                <div class="card">
                    <h3>üéØ Step Progress</h3>
                    <div class="step-indicator">
                        <div id="step1" class="step">Step 1<br>Save to DB</div>
                        <div id="step2" class="step">Step 2<br>Calculate Age</div>
                        <div id="step3" class="step">Step 3<br>Write to File</div>
                    </div>
                </div>

                <div class="card">
                    <h3>‚ö° Quick Stats</h3>
                    <div class="metrics">
                        <div class="metric">
                            <div id="totalExecutions" class="metric-value">0</div>
                            <div class="metric-label">Total Executions</div>
                        </div>
                        <div class="metric">
                            <div id="successfulExecutions" class="metric-value">0</div>
                            <div class="metric-label">Successful</div>
                        </div>
                        <div class="metric">
                            <div id="failedExecutions" class="metric-value">0</div>
                            <div class="metric-label">Failed</div>
                        </div>
                        <div class="metric">
                            <div id="avgDuration" class="metric-value">0s</div>
                            <div class="metric-label">Avg Duration</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>üõ†Ô∏è Fix-the-file Demo</h3>
                    <p style="margin-top:0">Run once with invalid rows, then run again with the corrected file to upsert fixes.</p>
                    <div>
                        <button class="button" onclick="runFixScenarioStep1()">1) Run with invalid CSV</button>
                        <button class="button success" onclick="runFixScenarioStep2()">2) Run with fixed CSV</button>
                    </div>
                    <div style="margin-top:10px; font-size: 12px; color: #555;">
                        Uses files: <code>input/persons_fix_scenario_step1.csv</code> ‚Üí <code>input/persons_fix_scenario_step2_fixed.csv</code>
                    </div>
                </div>
            </div>
        </div>

        <!-- Executions Tab -->
        <div id="executions" class="tab-content">
            <h2>üìã Job Execution History</h2>
            <button class="button" onclick="loadExecutionHistory()">üîÑ Load History</button>
            <div id="executionHistory" class="execution-history">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading execution history...</p>
                </div>
            </div>
        </div>

        <!-- Metrics Tab -->
        <div id="metrics" class="tab-content">
            <h2>üìà Detailed Metrics</h2>
            <div class="dashboard">
                <div class="card">
                    <h3>üìä Performance Metrics</h3>
                    <div id="performanceMetrics">
                        <p>Loading metrics...</p>
                    </div>
                </div>
                <div class="card">
                    <h3>üóÑÔ∏è Database Stats</h3>
                    <div id="databaseStats">
                        <p>Loading database stats...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Logs Tab -->
        <div id="logs" class="tab-content">
            <h2>üìù Recent Logs</h2>
            <button class="button" onclick="loadLogs()">üîÑ Load Logs</button>
            <div id="logsContainer">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading logs...</p>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <h2>üîß Available Endpoints</h2>
        <div class="dashboard">
            <div class="card">
                <h3>üéÆ Job Control</h3>
                <div class="endpoint">POST /api/jobs/start - Start the batch job</div>
                <div class="endpoint">GET /api/jobs/status - Get job controller status</div>
                <div class="endpoint">POST /api/jobs/stop - Stop running job</div>
                <div class="endpoint">POST /api/jobs/restart - Restart job</div>
            </div>
            <div class="card">
                <h3>üìä Monitoring</h3>
                <div class="endpoint">GET /api/jobs/executions - List job executions</div>
                <div class="endpoint">GET /api/jobs/metrics - Job metrics</div>
                <div class="endpoint">GET /actuator/health - Application health</div>
                <div class="endpoint">GET /actuator/metrics - Application metrics</div>
            </div>
            <div class="card">
                <h3>üóÑÔ∏è Database</h3>
                <div class="endpoint">GET /h2-console - Database console</div>
                <div class="endpoint">GET /api/persons - List all persons</div>
                <div class="endpoint">GET /api/persons/count - Person count</div>
            </div>
        </div>
    </div>

    <script>
        let currentJobExecution = null;
        let refreshInterval = null;

        // Tab switching
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // Load tab-specific data
            switch(tabName) {
                case 'executions':
                    loadExecutionHistory();
                    break;
                case 'metrics':
                    loadMetrics();
                    break;
                case 'logs':
                    loadLogs();
                    break;
            }
        }

        // Job control functions
        async function startJob() {
            const button = event.target;
            button.disabled = true;
            button.textContent = 'üîÑ Starting...';
            
            try {
                const scenario = document.getElementById('scenarioSelect').value;
                const largeFile = document.getElementById('largeFileSelect').value || null;
                const skipEvery = document.getElementById('skipEveryInput').value || null;
                const retryAttempts = document.getElementById('retryAttemptsInput').value || null;
                const csvPath = document.getElementById('csvSelect').value || null;

                // Use large file if selected, otherwise use csvPath
                const finalCsvPath = largeFile || csvPath;

                const response = await fetch('/api/jobs/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ scenario, skipEvery, retryAttempts, csvPath: finalCsvPath })
                });
                
                const result = await response.text();
                
                if (response.ok) {
                    showStatus('‚úÖ Job started successfully! Monitoring progress...', 'success');
                    startMonitoring();
                } else {
                    showStatus('‚ùå Error starting job: ' + result, 'error');
                }
            } catch (error) {
                showStatus('‚ùå Error: ' + error.message, 'error');
            } finally {
                button.disabled = false;
                button.textContent = '‚ñ∂Ô∏è Start Job';
            }
        }

        async function runFixScenarioStep1() {
            // First pass with invalid rows
            try {
                const response = await fetch('/api/jobs/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ scenario: 'SUCCESS', csvPath: 'input/persons_fix_scenario_step1.csv' })
                });
                const result = await response.text();
                if (response.ok) {
                    showStatus('‚ñ∂Ô∏è Step 1 started: invalid CSV loaded. Now run Step 2 to apply fixes.', 'info');
                    startMonitoring();
                } else {
                    showStatus('‚ùå Step 1 error: ' + result, 'error');
                }
            } catch (e) {
                showStatus('‚ùå Step 1 error: ' + e.message, 'error');
            }
        }

        async function runFixScenarioStep2() {
            // Second pass with corrected rows to upsert
            try {
                const response = await fetch('/api/jobs/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ scenario: 'SUCCESS', csvPath: 'input/persons_fix_scenario_step2_fixed.csv' })
                });
                const result = await response.text();
                if (response.ok) {
                    showStatus('‚úÖ Step 2 started: fixed CSV loaded. Previously invalid rows will be upserted.', 'success');
                    startMonitoring();
                } else {
                    showStatus('‚ùå Step 2 error: ' + result, 'error');
                }
            } catch (e) {
                showStatus('‚ùå Step 2 error: ' + e.message, 'error');
            }
        }

        async function stopJob() {
            try {
                const response = await fetch('/api/jobs/stop', { method: 'POST' });
                const result = await response.text();
                
                if (response.ok) {
                    showStatus('‚èπÔ∏è Job stopped successfully', 'info');
                    stopMonitoring();
                } else {
                    showStatus('‚ùå Error stopping job: ' + result, 'error');
                }
            } catch (error) {
                showStatus('‚ùå Error: ' + error.message, 'error');
            }
        }

        async function restartJob() {
            try {
                const response = await fetch('/api/jobs/restart', { method: 'POST' });
                const result = await response.text();
                
                if (response.ok) {
                    showStatus('üîÑ Job restarted successfully', 'success');
                    startMonitoring();
                } else {
                    showStatus('‚ùå Error restarting job: ' + result, 'error');
                }
            } catch (error) {
                showStatus('‚ùå Error: ' + error.message, 'error');
            }
        }

        async function refreshJobStatus() {
            try {
                const response = await fetch('/api/jobs/status');
                const result = await response.text();
                showStatus('‚ÑπÔ∏è ' + result, 'info');
                
                // Also update metrics
                updateQuickStats();
            } catch (error) {
                showStatus('‚ùå Error getting status: ' + error.message, 'error');
            }
        }

        // Monitoring functions
        function startMonitoring() {
            if (refreshInterval) clearInterval(refreshInterval);
            // Poll less frequently to reduce log noise
            refreshInterval = setInterval(updateJobProgress, 5000);
            updateJobProgress(); // Initial call
        }

        function stopMonitoring() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
                refreshInterval = null;
            }
        }

        async function updateJobProgress() {
            try {
                const response = await fetch('/api/jobs/executions');
                const data = await response.json();
                
                if (data && data.length > 0) {
                    const latestExecution = data[0];
                    updateProgressBar(latestExecution);
                    updateStepIndicators(latestExecution);
                    renderSkipInfo(latestExecution);
                    // Stop polling once job is finished
                    if (latestExecution.status === 'COMPLETED' || latestExecution.status === 'FAILED') {
                        stopMonitoring();
                    }
                }
            } catch (error) {
                console.log('Error updating progress:', error);
            }
        }

        function renderSkipInfo(execution) {
            const stepCard = document.querySelector('#dashboard .card:nth-child(2)');
            let container = document.getElementById('skipInfo');
            if (!container) {
                container = document.createElement('div');
                container.id = 'skipInfo';
                container.style.marginTop = '10px';
                stepCard.appendChild(container);
            }
            const steps = execution.stepExecutions || [];
            const skippedSteps = steps.filter(s => (s.skipCount || 0) > 0);
            if (skippedSteps.length === 0) {
                container.innerHTML = '';
                return;
            }
            const html = skippedSteps.map(s => `
                <div class="status warning">
                    <div><strong>Step:</strong> ${s.stepName}</div>
                    <div><strong>Skipped items:</strong> ${s.skipCount}</div>
                    ${s.skipSummary ? `<div><strong>Details:</strong> ${s.skipSummary}</div>` : ''}
                </div>
            `).join('');
            container.innerHTML = `<h4>Skipped Items</h4>${html}`;
        }

        function updateProgressBar(execution) {
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            
            if (execution.status === 'COMPLETED') {
                progressBar.style.width = '100%';
                progressText.textContent = '‚úÖ Job completed successfully';
            } else if (execution.status === 'FAILED') {
                progressBar.style.width = '100%';
                progressBar.style.background = 'linear-gradient(90deg, #e74c3c, #c0392b)';
                progressText.textContent = '‚ùå Job failed';
            } else if (execution.status === 'RUNNING') {
                const progress = (execution.stepExecutions || []).length * 33.33;
                progressBar.style.width = Math.min(progress, 99) + '%';
                progressText.textContent = 'üîÑ Job running... ' + Math.round(progress) + '%';
            }
        }

        function updateStepIndicators(execution) {
            const steps = ['step1', 'step2', 'step3'];
            const stepExecutions = execution.stepExecutions || [];
            
            steps.forEach((stepId, index) => {
                const stepElement = document.getElementById(stepId);
                const stepExecution = stepExecutions.find(se => se.stepName.includes(`step${index + 1}`));
                
                if (stepExecution) {
                    if (stepExecution.status === 'COMPLETED') {
                        stepElement.className = 'step completed';
                    } else if (stepExecution.status === 'FAILED') {
                        stepElement.className = 'step failed';
                    } else {
                        stepElement.className = 'step active';
                    }
                } else {
                    stepElement.className = 'step';
                }
            });
        }

        async function updateQuickStats() {
            try {
                const response = await fetch('/api/jobs/metrics');
                const data = await response.json();
                
                document.getElementById('totalExecutions').textContent = data.totalExecutions || 0;
                document.getElementById('successfulExecutions').textContent = data.successfulExecutions || 0;
                document.getElementById('failedExecutions').textContent = data.failedExecutions || 0;
                
                // Format average duration
                const avgDuration = data.avgDuration || 0;
                document.getElementById('avgDuration').textContent = Math.round(avgDuration / 1000) + 's';
            } catch (error) {
                console.log('Error updating stats:', error);
            }
        }

        async function loadExecutionHistory() {
            const container = document.getElementById('executionHistory');
            container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading execution history...</p></div>';
            
            try {
                const response = await fetch('/api/jobs/executions');
                const data = await response.json();
                
                if (data && data.length > 0) {
                    const historyHtml = data.map(execution => `
                        <div class="execution-item ${execution.status.toLowerCase()}">
                            <h4>Job Execution #${execution.id}</h4>
                            <p><strong>Status:</strong> ${execution.status}</p>
                            <p><strong>Start Time:</strong> ${new Date(execution.startTime).toLocaleString()}</p>
                            <p><strong>End Time:</strong> ${execution.endTime ? new Date(execution.endTime).toLocaleString() : 'Running...'}</p>
                            <p><strong>Duration:</strong> ${execution.duration ? Math.round(execution.duration / 1000) + 's' : 'N/A'}</p>
                            <p><strong>Exit Code:</strong> ${execution.exitCode || 'N/A'}</p>
                        </div>
                    `).join('');
                    container.innerHTML = historyHtml;
                } else {
                    container.innerHTML = '<p>No job executions found.</p>';
                }
            } catch (error) {
                container.innerHTML = '<p>Error loading execution history: ' + error.message + '</p>';
            }
        }

        async function loadMetrics() {
            try {
                const response = await fetch('/api/jobs/metrics');
                const data = await response.json();
                
                document.getElementById('performanceMetrics').innerHTML = `
                    <div class="metrics">
                        <div class="metric">
                            <div class="metric-value">${data.totalExecutions || 0}</div>
                            <div class="metric-label">Total Executions</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${data.successfulExecutions || 0}</div>
                            <div class="metric-label">Successful</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${data.failedExecutions || 0}</div>
                            <div class="metric-label">Failed</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${Math.round((data.successRate || 0) * 100) / 100}%</div>
                            <div class="metric-label">Success Rate</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${Math.round((data.avgDuration || 0) / 1000)}s</div>
                            <div class="metric-label">Avg Duration</div>
                        </div>
                    </div>
                `;
            } catch (error) {
                document.getElementById('performanceMetrics').innerHTML = '<p>Error loading metrics: ' + error.message + '</p>';
            }
        }

        async function loadLogs() {
            const container = document.getElementById('logsContainer');
            container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading logs...</p></div>';
            
            try {
                // For now, we'll show a placeholder since we don't have a logs endpoint
                container.innerHTML = `
                    <div class="card">
                        <h3>üìù Recent Application Logs</h3>
                        <p>Log monitoring is available through:</p>
                        <ul>
                            <li>Console output when running the application</li>
                            <li>Log files (if configured)</li>
                            <li>Spring Boot Actuator endpoints</li>
                        </ul>
                        <p><strong>Current Log Level:</strong> DEBUG</p>
                        <p><strong>Log Pattern:</strong> %d{yyyy-MM-dd HH:mm:ss} - %msg%n</p>
                    </div>
                `;
            } catch (error) {
                container.innerHTML = '<p>Error loading logs: ' + error.message + '</p>';
            }
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('jobStatus');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            refreshJobStatus();
            updateQuickStats();
            
            // Auto-refresh status every 30 seconds
            setInterval(refreshJobStatus, 30000);
        });
    </script>
</body>
</html> 